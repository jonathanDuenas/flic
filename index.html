<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Flic by kouphax</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/kouphax/flic">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/kouphax/flic/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/kouphax/flic/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Flic</h1>
          <p>Simple feature toggles</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/kouphax">kouphax</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a name="introduction" class="anchor" href="#introduction"><span class="octicon octicon-link"></span></a>Introduction</h1>

<p>On <a href="https://clojars.org/flic">clojars</a></p>

<p>Flic is a lightweight <a href="http://martinfowler.com/bliki/FeatureToggle.html">feature toggle library</a> for Clojure based loosely on <a href="https://github.com/FetLife/rollout">rolllout</a>.  Useful for slowly releasing features to users or helping facilitate some A/B testing.</p>

<p>It offers pluggable support for different storage mediums (in memory, redis, sql etc)</p>

<p>It can be used to control features around</p>

<ul>
<li>specific users</li>
<li>groups of users (defined by a predicate)</li>
<li>percentage of users</li>
</ul><p>The effects are componded.  So if you deactivate a specific user but they are part of a specific group or match against the baseline percentage of activated users they will still see the feature.  To this end - this is NOT an access control mechanism for restricting access.  Well its not intended to be anyway. YMMV.  </p>

<h1>
<a name="contents" class="anchor" href="#contents"><span class="octicon octicon-link"></span></a>Contents</h1>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li>
<a href="#usage">Usage</a>

<ul>
<li><a href="#users">Users</a></li>
<li><a href="#groups">Groups</a></li>
<li><a href="#percentages">Percentages</a></li>
<li><a href="#blanket-activationdeactivation">Blanket Activation/Deactivation</a></li>
</ul>
</li>
<li>
<a href="#stores">Stores</a>

<ul>
<li><a href="#in-memory-store">In Memory Store</a></li>
</ul>
</li>
<li><a href="#license">License</a></li>
</ul><h1>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h1>

<p>Get it into your <code>project.clj</code> dependencies</p>

<div class="highlight highlight-clojure"><pre><span class="p">[</span><span class="nv">flic</span> <span class="s">"0.0.1"</span><span class="p">]</span>
</pre></div>

<p>Use it.</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">require</span> <span class="p">[</span><span class="nv">flic.core</span> <span class="ss">:as</span> <span class="nv">flic</span><span class="p">])</span>
</pre></div>

<p>From here we need to initialise a backing store that will be responsible for getting and setting features. The simplest one for now is the in memory store that uses an atom to persist the feature state.  We can set this by requiring the <code>flic.store</code> namespace (you can write your own as well, yes please).</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">examples</span>
  <span class="p">(</span><span class="nf">require</span> <span class="p">[</span><span class="nv">flic.store</span> <span class="ss">:as</span> <span class="nv">store</span><span class="p">]</span>
           <span class="p">[</span><span class="nv">flic.core</span> <span class="ss">:as</span> <span class="nv">flic</span><span class="p">])</span>

<span class="p">(</span><span class="nf">flic/backing-store!</span> <span class="p">(</span><span class="nf">store/in-memory-store</span><span class="p">))</span>
</pre></div>

<p>Now we can test what features each user has access to</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">flic/active?</span> <span class="ss">:my-feature</span> <span class="nv">user</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">do-some-awesome-feature-thing</span><span class="p">))</span>
</pre></div>

<p>A user is a special-ish thing in the context of flic and we talk about that shortly.  But how do we actually <strong>activate</strong> users?  Read on...</p>

<h2>
<a name="users" class="anchor" href="#users"><span class="octicon octicon-link"></span></a>Users</h2>

<p>You can activate and deactivate specific users.</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">flic/activate-user!</span> <span class="ss">:my-feature</span> <span class="nv">user</span><span class="p">)</span>
</pre></div>

<p>This will activate a user for a given feature (identified by <code>:my-feature</code> here).  A user, in the current version is a data strucutre that can produce a value when asked for <code>:id</code> e.g. { :id 1 :name "James" }.  This is currently not configurable.  Should it be?</p>

<p>You can deactivate this user in a similar way</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">flic/deactivate-user!</span> <span class="ss">:my-feature</span> <span class="nv">user</span><span class="p">)</span>
</pre></div>

<h2>
<a name="groups" class="anchor" href="#groups"><span class="octicon octicon-link"></span></a>Groups</h2>

<p>Groups are clusters of users that you identify using a predicate.  To use these effectively you need to define the predicate for groups outside of the actual feature store.  If you fail to define a group and then activate that group the group test will always be false. So make sure you do, or make sure I find a better way to represent this.</p>

<p>So we start by defining a group (require the <code>flic.groups</code> namespace).</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">groups/define-group</span> <span class="ss">:best-people</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">user</span><span class="p">]</span> <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="ss">:name</span> <span class="nv">user</span><span class="p">)</span> <span class="s">"James"</span><span class="p">)))</span>
</pre></div>

<p>This defines a group called <code>:best-people</code> that identifies all users whose name is <code>James</code> as a member of the group.</p>

<p>We can also define a a bunch of groups in one go.</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">groups/define-groups</span> <span class="p">{</span> <span class="ss">:best-people</span>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">user</span><span class="p">]</span> <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="ss">:name</span> <span class="nv">user</span><span class="p">)</span> <span class="s">"James"</span><span class="p">))</span>
                        <span class="ss">:worst-people</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">user</span><span class="p">]</span> <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="ss">:name</span> <span class="nv">user</span><span class="p">)</span> <span class="s">"James"</span><span class="p">)))</span> <span class="p">})</span>
</pre></div>

<p>Now we can include these groups in our activation scenarios</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">flic/activate-group!</span> <span class="ss">:my-feature</span> <span class="ss">:best-people</span><span class="p">)</span>
</pre></div>

<p>Remember if its not defined it just returns false for now.  I dont like this.  Help me change it please.</p>

<p>Deactivating a group is not suprising.</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">flic/deactivate-group!</span> <span class="ss">:my-feature</span> <span class="ss">:best-people</span><span class="p">)</span>
</pre></div>

<p>If you want you can also check if a person belongs to a group using
<code>(is-in-group? group user)</code></p>

<h2>
<a name="percentages" class="anchor" href="#percentages"><span class="octicon octicon-link"></span></a>Percentages</h2>

<p>Finally you can activate users via percentage of user base.  This is based on the id of the user and assumes its a number.  The percentages are rolling so activating 20% then upping it to 25% means the previous 20% will still be included in the activated people so it won't be all "You're included", "You're not included" nonsense as you roll out a new feature.</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">flic/activate-percentage!</span> <span class="ss">:my-feature</span> <span class="mi">20</span><span class="p">)</span>

<span class="p">(</span><span class="nf">flic/deactivate-percentage!</span> <span class="ss">:my-feature</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>

<h2>
<a name="blanket-activationdeactivation" class="anchor" href="#blanket-activationdeactivation"><span class="octicon octicon-link"></span></a>Blanket Activation/Deactivation</h2>

<p>You can activate and deactivate everyone.  Say your feature is golden and good to go or perhaps your feature is broken you can use the <code>activate-all!</code> and <code>deactivate-all!</code> to make you happy.</p>

<h1>
<a name="stores" class="anchor" href="#stores"><span class="octicon octicon-link"></span></a>Stores</h1>

<p>A store is an implementation of the <code>FeatureStore</code> protocol in the <code>flic.store</code> namespace and this is what is used to persist feature configuration longer term.  Implementor of the protocol simply need the ability to <code>get</code> a feature and <code>set!</code> a feature.  The provided in-memory store is a good example of a simple implementation</p>

<h2>
<a name="in-memory-store" class="anchor" href="#in-memory-store"><span class="octicon octicon-link"></span></a>In Memory Store</h2>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="kd">defprotocol </span><span class="nv">FeatureStore</span>
  <span class="s">"defines the contract used when working with a feature storage thing"</span>
  <span class="p">(</span><span class="nf">get-feature</span>  <span class="p">[</span><span class="nv">store</span> <span class="nv">key</span><span class="p">]</span>      <span class="s">"retrieves a feature"</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">set-feature!</span> <span class="p">[</span><span class="nv">store</span> <span class="nb">key </span><span class="nv">data</span><span class="p">]</span> <span class="s">"saves the current feature"</span><span class="p">))</span>

<span class="p">(</span><span class="kd">deftype </span><span class="nv">InMemoryStore</span> <span class="p">[</span><span class="nv">features</span><span class="p">]</span>
  <span class="nv">FeatureStore</span>
  <span class="p">(</span><span class="nf">get-feature</span>  <span class="p">[</span><span class="nv">store</span> <span class="nv">key</span><span class="p">]</span>      <span class="p">(</span><span class="nb">get </span><span class="o">@</span><span class="nv">features</span> <span class="p">(</span><span class="nb">keyword </span><span class="nv">key</span><span class="p">)</span> <span class="p">{}))</span>
  <span class="p">(</span><span class="nf">set-feature!</span> <span class="p">[</span><span class="nv">store</span> <span class="nb">key </span><span class="nv">data</span><span class="p">]</span> <span class="p">(</span><span class="nf">swap!</span> <span class="nv">features</span> <span class="o">#</span><span class="p">(</span><span class="nb">assoc </span><span class="nv">%</span> <span class="p">(</span><span class="nb">keyword </span><span class="nv">key</span><span class="p">)</span> <span class="nv">data</span><span class="p">))))</span>
</pre></div>

<p>There is also a helper provided to construct an in-memory store with or without initial state</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">in-memory-store</span> <span class="p">{</span> <span class="ss">:my-feature</span> <span class="p">{</span> <span class="ss">:groups</span> <span class="o">#</span><span class="p">{</span> <span class="ss">:all</span> <span class="p">}</span> <span class="p">}</span> <span class="p">})</span>
</pre></div>

<h1>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h1>

<p>Copyright © 2014 James Hughes</p>

<p>Distributed under the Eclipse Public License either version 1.0 or (at
your option) any later version.</p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-19143623-5");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>