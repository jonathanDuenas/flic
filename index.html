<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Flic by kouphax</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Flic</h1>
        <p>simple feature toggles</p>

        <p class="view"><a href="https://github.com/kouphax/flic">View the Project on GitHub <small>kouphax/flic</small></a></p>


        <ul>
          <li><a href="https://github.com/kouphax/flic/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/kouphax/flic/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/kouphax/flic">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="flic" class="anchor" href="#flic"><span class="octicon octicon-link"></span></a>flic</h1>

<p>Flic is a lightweight <a href="http://martinfowler.com/bliki/FeatureToggle.html">feature toggle library</a> for Clojure based loosely on <a href="https://github.com/FetLife/rollout">rolllout</a>.</p>

<p>It offers pluggable support for different storage mediums (in memory, redis, sql etc)</p>

<p>It can be used to control features around</p>

<ul>
<li>specific users</li>
<li>groups of users (defined by a predicate)</li>
<li>percentage of users</li>
</ul><p>The effects are componded.  So if you deactivate a specific user but they are part of a specific group or match against the baseline percentage of activated users they will still see the feature.  To this end - this is NOT an access control mechanism for restricting access.  Well its not intended to be anyway. YMMV.  </p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Get it into your <code>project.clj</code> dependencies</p>

<div class="highlight highlight-clojure"><pre><span class="p">[</span><span class="nv">flic</span> <span class="s">"0.0.1"</span><span class="p">]</span>
</pre></div>

<p>Use it.</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">require</span> <span class="p">[</span><span class="nv">flic.core</span> <span class="ss">:as</span> <span class="nv">flic</span><span class="p">])</span>
</pre></div>

<p>From here we need to initialise a backing store that will be responsible for getting and setting features. The simplest one for now is the in memory store that uses an atom to persist the feature state.  We can set this by requiring the <code>flic.store</code> namespace (you can write your own as well, yes please).</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="kd">ns </span><span class="nv">examples</span>
  <span class="p">(</span><span class="nf">require</span> <span class="p">[</span><span class="nv">flic.store</span> <span class="ss">:as</span> <span class="nv">store</span><span class="p">]</span>
           <span class="p">[</span><span class="nv">flic.core</span> <span class="ss">:as</span> <span class="nv">flic</span><span class="p">])</span>

<span class="p">(</span><span class="nf">flic/backing-store!</span> <span class="p">(</span><span class="nf">store/in-memory-store</span><span class="p">))</span>
</pre></div>

<p>Now we can test what features each user has access to</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">flic/active?</span> <span class="ss">:my-feature</span> <span class="nv">user</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">do-some-awesome-feature-thing</span><span class="p">))</span>
</pre></div>

<p>A user is a special-ish thing in the context of flic and we talk about that shortly.  But how do we actually <strong>activate</strong> users?  Read on...</p>

<h2>
<a name="users" class="anchor" href="#users"><span class="octicon octicon-link"></span></a>Users</h2>

<p>You can activate and deactivate specific users.</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">flic/activate-user!</span> <span class="ss">:my-feature</span> <span class="nv">user</span><span class="p">)</span>
</pre></div>

<p>This will activate a user for a given feature (identified by <code>:my-feature</code> here).  A user, in the current version is a data strucutre that can produce a value when asked for <code>:id</code> e.g. { :id 1 :name "James" }.  This is currently not configurable.  Should it be?</p>

<p>You can deactivate this user in a similar way</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">flic/deactivate-user!</span> <span class="ss">:my-feature</span> <span class="nv">user</span><span class="p">)</span>
</pre></div>

<h2>
<a name="groups" class="anchor" href="#groups"><span class="octicon octicon-link"></span></a>Groups</h2>

<p>Groups are clusters of users that you identify using a predicate.  To use these effectively you need to define the predicate for groups outside of the actual feature store.  If you fail to define a group and then activate that group the group test will always be false. So make sure you do, or make sure I find a better way to represent this.</p>

<p>So we start by defining a group (require the <code>flic.groups</code> namespace).</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">groups/define-group</span> <span class="ss">:best-people</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">user</span><span class="p">]</span> <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="ss">:name</span> <span class="nv">user</span><span class="p">)</span> <span class="s">"James"</span><span class="p">)))</span>
</pre></div>

<p>This defines a group called <code>:best-people</code> that identifies all users whose name is <code>James</code> as a member of the group.</p>

<p>We can also define a a bunch of groups in one go.</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">groups/define-groups</span> <span class="p">{</span> <span class="ss">:best-people</span>  <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">user</span><span class="p">]</span> <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="ss">:name</span> <span class="nv">user</span><span class="p">)</span> <span class="s">"James"</span><span class="p">))</span>
                        <span class="ss">:worst-people</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">user</span><span class="p">]</span> <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="ss">:name</span> <span class="nv">user</span><span class="p">)</span> <span class="s">"James"</span><span class="p">)))</span> <span class="p">})</span>
</pre></div>

<p>Now we can include these groups in our activation scenarios</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">flic/activate-group!</span> <span class="ss">:my-feature</span> <span class="ss">:best-people</span><span class="p">)</span>
</pre></div>

<p>Remember if its not defined it just returns false for now.  I dont like this.  Help me change it please.</p>

<p>Deactivating a group is not suprising.</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">flic/deactivate-group!</span> <span class="ss">:my-feature</span> <span class="ss">:best-people</span><span class="p">)</span>
</pre></div>

<p>If you want you can also check if a person belongs to a group using
<code>(is-in-group? group user)</code></p>

<h2>
<a name="percentages" class="anchor" href="#percentages"><span class="octicon octicon-link"></span></a>Percentages</h2>

<p>Finally you can activate users via percentage of user base.  This is based on the id of the user and assumes its a number.  The percentages are rolling so activating 20% then upping it to 25% means the previous 20% will still be included in the activated people so it won't be all "You're included", "You're not included" nonsense as you roll out a new feature.</p>

<div class="highlight highlight-clojure"><pre><span class="p">(</span><span class="nf">flic/activate-percentage!</span> <span class="ss">:my-feature</span> <span class="mi">20</span><span class="p">)</span>

<span class="p">(</span><span class="nf">flic/deactivate-percentage!</span> <span class="ss">:my-feature</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>

<h2>
<a name="blanket-deactivation" class="anchor" href="#blanket-deactivation"><span class="octicon octicon-link"></span></a>Blanket (De)Activation</h2>

<p>You can activate and deactivate everyone.  Say your feature is golden and good to go or perhaps your feature is broken you can use the <code>activate-all!</code> and <code>deactivate-all!</code> to make you happy.</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>Copyright Â© 2014 James Hughes</p>

<p>Distributed under the Eclipse Public License either version 1.0 or (at
your option) any later version.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/kouphax">kouphax</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-19143623-5");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>